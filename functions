#!/bin/bash
#
# functions
#

STAT_COL=$[`stty size | awk 'BEGIN { RS=" " }; END { print $1 }'` - 13]

deltext() {
	echo -ne "\033[$(($STAT_COL+4))G"
}

stat_busy() {
	if [ "$USECOLOR" = "YES" -o "$USECOLOR" = "yes" ]; then
		echo -ne "\033[1;32m| \033[1;37m$1\033[1;0m "
		awk "BEGIN { for (j=length(\"$1\"); j<$STAT_COL; j++) printf \" \" }"
		echo -ne "   \033[1;34m[\033[1;33mbusy\033[1;34m]\033[1;0m "
	else
		echo -n "| $1 "
		awk "BEGIN { for (j=length(\"$1\"); j<$STAT_COL; j++) printf \" \" }"
		echo -n "   [busy] "
	fi
}

stat_done() {
	deltext
	if [ "$USECOLOR" = "YES" -o "$USECOLOR" = "yes" ]; then
		echo -e "   \033[1;34m[\033[1;32mdone\033[1;34m] \033[1;0m"
	else
		echo "   [done] "
	fi
}

stat_fail() {
	deltext
	if [ "$USECOLOR" = "YES" -o "$USECOLOR" = "yes" ]; then
		echo -e "   \033[1;34m[\033[1;31mfail\033[1;34m] \033[1;0m"
	else
		echo "   [fail] "
	fi
}

stat_die() {
	retval=1
	[ "$1" = "" ] || retval=$1
	stat_fail
	exit $retval
}

#
# here for legcay reasons: use 'status' instead
#
checkret() {
	$* >/dev/null 2>&1
	if [ $? -gt 0 ]; then
		stat_fail
		return 0
	else
		stat_done
		return 1
	fi
}

status() {
	stat_busy "$1"
	shift
	$* >/dev/null 2>&1
	if [ $? -eq 0 ]; then
		stat_done
		return 0
	else
		stat_fail
		return 1
	fi
}

add_daemon() {
	[ -d /var/run/daemons ] || mkdir -p /var/run/daemons
	touch /var/run/daemons/$1
}

rm_daemon() {
	rm -f /var/run/daemons/$1
}

ck_daemon() {
	if [ -f /var/run/daemons/$1 ]; then
		return 1
	else
		return 0
	fi
}

# End of file
